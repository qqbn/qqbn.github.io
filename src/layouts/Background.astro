---
import { Image } from "astro:assets";
import background from "../assets/images/samurai4.png";
import blob from "../assets/icons/blob.svg"

---
<script>
let winWidth: number = 0;
const astroURL: string = 'https://unpkg.com/@splinetool/viewer@1.9.5/build/spline-viewer.js';
const MOBILE: number = 768;

const loadSpline = async () => {
    return new Promise<void> ((resolve, reject) => {
        const script = document.createElement('script');
        script.type = "module";
        script.src = astroURL;
        script.async = true;
        script.id = 'spline-script';

        script.addEventListener('load', () => resolve());

        script.addEventListener('error', () => reject());

        document.body.appendChild(script);
    })
}

const removeSpline = () => {
    const script = document.getElementById('spline-script');
    if(script){
        document.body.removeChild(script);
    }
}

const checkWinWidth = async () => {
    try {
        console.log(window.innerWidth);
        if(window.innerWidth >= MOBILE){
            await loadSpline();
        }else{
            removeSpline();
        }
    } catch (error) {
        console.log(error);
    }
} 

checkWinWidth()

window.addEventListener("resize", checkWinWidth);
</script>
<div class="background-wrapper">
    <slot />
    <spline-viewer id="background" class="viewer" loading-anim-type="spinner-small-dark" url="https://prod.spline.design/ifLDiKrphbkzwp37/scene.splinecode"><img src="data:image/png;base64,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" alt="Spline preview"/></spline-viewer>
    <div id="logo-hidden"></div>
    <div class="blob-container">
        <Image src={blob} alt="Animated blob"/>
    </div>
</div>
<style lang="scss">
    .background-wrapper{
        width: 100%;
        height: 100%;
    }
    #logo{
        display: none !important;
        visibility: none;
    }

    .viewer{
        z-index: -1;
        height: 100%;
        width: 100%;
        position: fixed;
        left: 0;
        top: 0;
    }

    #logo-hidden{
        position: fixed;
        z-index: -1;
        bottom: 20px;
        right: 20px;
        width: 140px;
        height: 40px;
        border-radius: 12px;
        background-color: #060709;
        display: flex;
    }
    .blob-container {
        max-width: 400px;
        width: 100%;
        height: 400px;
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translate(-50%);
        z-index: -1;
        display: none;

        // transform: translateY(-50%);
        img {
            width: 100%;
            height: 100%;
        }


        @media(max-width: 768px){
            display: flex;
        }

    }
</style>